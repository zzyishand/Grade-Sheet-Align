<!DOCTYPE html>  
<html>  
<head>  
    <title>Score Alignment Tool</title>  
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">  
</head>  
<body>  
    <!-- [Previous HTML structure remains the same until the script tag] -->  

    <script>  
        let isStandardLocked = false;  

        // [Previous event listeners and clear functions remain the same]  

        async function processData() {  
            const standard_col = document.getElementById('standard_col').value;  
            const align_col = document.getElementById('align_col').value;  
            const score_col = document.getElementById('score_col').value;  

            // Clean input data, remove possible numbering  
            const cleanStandard = standard_col.split('\n')  
                .map(line => line.replace(/^No\.\d+\s+/, '').trim())  
                .filter(line => line)  
                .join('\n');  

            if (!cleanStandard.trim()) {  
                alert('Please input standard list data');  
                return;  
            }  

            try {  
                const response = await fetch('/align', {  
                    method: 'POST',  
                    headers: {  
                        'Content-Type': 'application/json',  
                    },  
                    body: JSON.stringify({  
                        standard_col: cleanStandard,  
                        align_col: align_col,  
                        score_col: score_col  
                    })  
                });  

                const data = await response.json();  
                
                if (data.success) {  
                    // Update and lock standard column  
                    const standardTextarea = document.getElementById('standard_col');  
                    standardTextarea.value = data.numbered_standard.join('\n');  
                    standardTextarea.readOnly = true;  
                    isStandardLocked = true;  

                    // Ensure result list matches standard list length  
                    const standardList = data.numbered_standard;  
                    let alignedResult = new Array(standardList.length).fill(''); // Initialize with empty strings  

                    // Map scores to matching positions  
                    data.result.forEach((score, index) => {  
                        if (score !== null && score !== undefined) {  
                            alignedResult[index] = score;  
                        }  
                    });  

                    // Update result textarea  
                    document.getElementById('result').value = alignedResult.join('\n');  
                    document.getElementById('total_rows').textContent = `Total: ${standardList.length} rows`;  
                    
                    if (data.not_found && data.not_found.length > 0) {  
                        document.getElementById('not_found').innerHTML =   
                            'Warning: Items not found:<br>' + data.not_found.join('<br>');  
                    } else {  
                        document.getElementById('not_found').innerHTML = '';  
                    }  
                } else {  
                    alert('Processing failed: ' + data.error);  
                }  
            } catch (error) {  
                alert('Error occurred: ' + error);  
            }  
        }  

        // [Copy and message functions remain the same]  
    </script>  
</body>  
</html>  
